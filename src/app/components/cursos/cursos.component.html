<div class="bg-white dark:bg-gray-900 rounded-lg shadow p-4">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-primary">Listado de Cursos</h2>
        <button pButton type="button" icon="pi pi-plus" label="Nuevo" class="!bg-primary !border-primary !text-white"
            (click)="openNew()"></button>
    </div>
    <p-table [value]="cursos()" dataKey="id" class="p-datatable-sm" [tableStyle]="{ 'min-width': '100%' }" pTableResponsive>
        <ng-template pTemplate="header">
            <tr>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Duración</th>
                <th>Nivel</th>
                <th>Alumnos</th>
                <th>Estado</th>
                <th class="w-32 text-center">Acciones</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-curso>
            <tr>
                <td class="font-medium">{{ curso.nombre }}</td>
                <td>{{ curso.descripcion }}</td>
                <td>{{ curso.duracion }}</td>
                <td>
                    <span class="px-2 py-1 rounded text-xs font-semibold" [ngClass]="{
							'bg-blue-100 text-blue-800': curso.nivel === 'Básico',
							'bg-yellow-100 text-yellow-800': curso.nivel === 'Intermedio',
							'bg-red-100 text-red-800': curso.nivel === 'Avanzado'
						}">
                        {{ curso.nivel }}
                    </span>
                </td>
                <td class="text-center">{{ curso.alumnos }}</td>
                <td>
                    <span class="inline-block w-3 h-3 rounded-full mr-2"
                        [ngClass]="curso.activo ? 'bg-green-500' : 'bg-gray-400'"
                        aria-label="{{ curso.activo ? 'Abierto' : 'Cerrado' }}"></span>
                    <span class="text-xs font-medium" [ngClass]="curso.activo ? 'text-green-700' : 'text-gray-500'">
                        {{ curso.activo ? 'Abierto' : 'Cerrado' }}
                    </span>
                </td>
                <td class="flex gap-2 justify-center">
                    <button pButton type="button" icon="pi pi-eye" class="p-1 !text-blue-600"
                        (click)="openDetalle(curso)" aria-label="Ver Detalle" pTooltip="Ver detalle del curso"
                        tooltipPosition="top"></button>
                    <button pButton type="button" icon="pi pi-pencil" class="p-1 !text-primary"
                        (click)="editCurso(curso)" aria-label="Editar" pTooltip="Editar curso"
                        tooltipPosition="top"></button>
                    <button pButton type="button" icon="pi pi-trash" class="p-1 !text-red-600"
                        (click)="deleteCurso(curso)" aria-label="Eliminar" pTooltip="Eliminar curso"
                        tooltipPosition="top"></button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7" class="text-center text-gray-400">No hay cursos disponibles.</td>
            </tr>
        </ng-template>
    </p-table>

    <!-- Diálogo de detalle de curso -->
    <p-dialog [(visible)]="detalleDialogVisible" [modal]="true" [closable]="true" [dismissableMask]="true"
        [style]="{ width: '90vw', maxWidth: '500px' }" header="Detalle del Curso"
        (onHide)="closeDetalleDialog()">
        <app-curso-detalle [detalle]="detalleCurso"></app-curso-detalle>
    </p-dialog>

    <!-- Dialogo para agregar/editar -->
    <p-dialog
        [(visible)]="dialogVisible"
        [modal]="true"
        [closable]="true"
        [dismissableMask]="true"
        [style]="{ width: '90vw', maxWidth: '400px' }"
        [header]="editMode ? 'Editar Curso' : 'Nuevo Curso'"
        (onHide)="closeDialog()"
    >
        <form [formGroup]="cursoForm" (ngSubmit)="saveCurso()" class="flex flex-col gap-4">
            <div>
                <label class="block mb-1 font-medium">Nombre</label>
                <input pInputText formControlName="nombre" class="w-full" required />
            </div>
            <div>
                <label class="block mb-1 font-medium">Descripción</label>
                <input pInputText formControlName="descripcion" class="w-full" />
            </div>
            <div>
                <label class="block mb-1 font-medium">Duración</label>
                <input pInputText formControlName="duracion" class="w-full" required />
            </div>
            <div>
                <label class="block mb-1 font-medium">Nivel</label>
                <p-select [options]="niveles" optionLabel="label" optionValue="value" formControlName="nivel"
                    placeholder="Selecciona nivel" class="w-full"></p-select>
            </div>
            <div>
                <label class="block mb-1 font-medium">Alumnos</label>
                <input pInputNumber formControlName="alumnos" class="w-full" [min]="0" />
            </div>
            <div class="flex items-center gap-2">
                <input type="checkbox" formControlName="activo" id="activo" />
                <label for="activo" class="font-medium">Curso abierto</label>
            </div>
            <div class="flex justify-end gap-2 mt-2">
                <button pButton type="button" label="Cancelar" class="p-button-text" (click)="closeDialog()"></button>
                <button pButton type="submit" label="Guardar" [disabled]="cursoForm.invalid"
                    class="!bg-primary !border-primary !text-white"></button>
            </div>
        </form>
    </p-dialog>
</div>